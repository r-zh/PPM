@(projectRequest: cn.edu.sdu.sc.spepms.system.creation.project_requests.models.ProjectRequest, currentUser: cn.edu.sdu.sc.spepms.system.common.models.User)

@import cn.edu.sdu.sc.spepms.system.creation.project_requests.models.ProjectRequest

@layouts.basicLayout {

<form class="form-horizontal" method="post" role="form">
<div class="btn-group pull-right">
@if(projectRequest.getStatus==ProjectRequest.Status.UNDER_APPROVAL){
    <button type="button" class="btn btn-primary btn-lg btn-pass"
        href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.approve(projectRequest.getId)">
        <span class="glyphicon glyphicon-ok"></span>审核通过
    </button>
    <button type="button" class="btn btn-primary btn-lg btn-unpass"
        href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.reject(projectRequest.getId)">
        <span class="glyphicon glyphicon-remove"></span>审核失败
    </button>
    }
    @if(projectRequest.getStatus==ProjectRequest.Status.NEW || projectRequest.getStatus==ProjectRequest.Status.KILLED){
    <button type="button" class="btn btn-primary btn-lg btn-submit"
        href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.submit(projectRequest.getId)">
        <span class="glyphicon glyphicon-heart"></span>提交审核
    </button>
    }
    @if(!projectRequest.getMembers().contains(currentUser)){
        @if(projectRequest.getCurrentNumber < projectRequest.getNumber){
    <button type="button" class="btn btn-primary btn-lg btn-join"
        href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.join(projectRequest.getId)">
        <span class="glyphicon glyphicon-heart"></span>接受挑战
    </button>
        }
    
    }else{
    <button type="button" class="btn btn-primary btn-lg btn-cancelJoin"
        href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.leave(projectRequest.getId,currentUser.getId)">
        <span class="glyphicon glyphicon-heart"></span>黯然离去
    </button>
    }
    
</div>
</form>
<div class="page-header">
    <h1>项目概观</h1>
</div>

} {
<form method="post" role="form">
    <p class="alert alert-info">项目名称</p>
    <h3>@projectRequest.getName</h3>
    <p class="alert alert-info">项目类别</p>
    @if(projectRequest.getCategory()==ProjectRequest.Type.COMPETITION){
        <h3>竞赛</h3>
    } @if(projectRequest.getCategory()==ProjectRequest.Type.EXTERNAL){
        <h3>外部项目</h3>
    } @if(projectRequest.getCategory()==ProjectRequest.Type.PERSONAL){
        <h3>个人兴趣</h3>
    } @if(projectRequest.getCategory()==ProjectRequest.Type.RESEARCH){
        <h3>教师科研</h3>
    }
    <p class="alert alert-info">性质</p>
    <h3>@projectRequest.getBillable</h3>
    <p class="alert alert-info">额度</p>
    <h3>@projectRequest.getRewardAmount</h3>
    <p class="alert alert-info">项目需求介绍</p>
    <h3>@projectRequest.getDescription</h3>
    <p class="alert alert-info">时间范围</p>
    <h3>@projectRequest.getApplicableFrom - @projectRequest.getApplicableTo</h3>
    <p class="alert alert-info">联系咨询方式</p>
    <h3>@projectRequest.getContactInfo</h3>
    <p class="alert alert-info">报考人数限制</p>
    <h3>@projectRequest.getNumber</h3>
</form>
<div id="accordion" class="accordion-style1 panel-group">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h2 class="panel-title">
                <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseNine"> <i class="ace-icon fa fa-angle-down bigger-110"
                    data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i> &nbsp;报名情况:&nbsp;已报<i>@projectRequest.getMembers().size</i>人
                </a>
            </h2>
        </div>
        @if(projectRequest.getCreatedBy==currentUser.getId){
        <div class="panel-collapse collapse in" id="collapseNine">
            <div class="panel-body">
                <table id="sample-table-2" class="table table-striped table-bordered table-hover">
                    <thead>
                        <tr>
                            <th>姓名</th>
                            <th>学号</th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        @for(member <- projectRequest.getMembers) {
                        <tr>
                            <td><a href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.view(projectRequest.getId)">@member.getName</a></td>
                            <td>@member.getStudentId</td>
                            <td>
                                <div class="hidden-sm hidden-xs action-buttons">
                                    <a class="red btn-cancelJoin" href="@cn.edu.sdu.sc.spepms.system.creation.project_requests.controllers.routes.ProjectRequestsController.leave(projectRequest.getId,member.getId)"> <i
                                        class="ace-icon fa fa-trash-o bigger-130"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>}
    </div>
</div>
} {

<script>
$('.btn-pass').click(function() {
        if(!confirm("你确认要通过审核吗？")) {
            return false;
        }

        var url = $(this).attr('href');
        console.log("ajax - " + url);
        $.post(url, function (data) {
            console.log("返回结果："+data);
            alert("操作成功");
            location.reload()
        });
        return false;
    });

$('.btn-unpass').click(function() {
        if(!confirm("你确认审核不通过吗？")) {
            return false;
        }

        var url = $(this).attr('href');
        console.log("ajax - " + url);
        $.post(url, function (data) {
            console.log("返回结果："+data);
            alert("操作成功");
            location.reload()
        });
        return false;
    });

    $('.btn-submit').click(function() {
        if(!confirm("你确认要提交审核吗？")) {
            return false;
        }

        var url = $(this).attr('href');
        console.log("ajax - " + url);
        $.post(url, function (data) {
            console.log("返回结果："+data);
            alert("操作成功");
            location.reload()
        });
        return false;
    });

    $('.btn-join').click(function() {
        if(!confirm("你确认要参加该项目吗？")) {
            return false;
        }

        var url = $(this).attr('href');
        console.log("ajax - " + url);
        $.post(url, function (data) {
            console.log("返回结果："+data);
            alert("操作成功");
            location.reload()
        });
        return false;
    });

    $('.btn-cancelJoin').click(function() {
        if(!confirm("你确认要取消参加该项目吗？")) {
            return false;
        }

        var url = $(this).attr('href');
        console.log("ajax - " + url);
        $.post(url, function (data) {
            console.log("返回结果："+data);
            alert("操作成功");
            location.reload()
        });
        return false;
    });

</script>

}
